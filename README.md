# ğŸŒ Earthquake Dashboard â€“ Deployment Guide

## ğŸš€ Features
- ğŸ“Š Real-time Earthquake Dashboard
- ğŸ³ Dockerized Flask Application
- â˜¸ï¸ Deployed on Kubernetes with k3s
- ğŸ”„ GitOps deployment with ArgoCD
- ğŸ“ Structured logging to `/var/log/flask-data`

---

## ğŸ§° Prerequisites
- [k3s](https://k3s.io/) - Lightweight Kubernetes distribution
- [kubectl](https://kubernetes.io/docs/tasks/tools/)
- [Helm](https://helm.sh/docs/intro/install/)
- Internet connection (for pulling Docker images from Docker Hub)

---

### ğŸªŸ For Windows Users (WSL2)

1. Install and enable **WSL 2** (if not already):
   - [WSL 2 installation guide](https://learn.microsoft.com/en-us/windows/wsl/install)
2. Install Ubuntu or your preferred Linux distribution from Microsoft Store
3. Open WSL terminal and proceed with k3s installation (handled by deployment script)

---

### ğŸ§ For Linux Users

k3s will be automatically installed by the deployment script if not already present.

**Optional - Install Google Chrome for automatic browser opening:**
```bash
wget -q -O - https://dl.google.com/linux/linux_signing_key.pub | sudo apt-key add -
echo "deb [arch=amd64] http://dl.google.com/linux/chrome/deb/ stable main" | sudo tee /etc/apt/sources.list.d/google-chrome.list
sudo apt update
sudo apt install google-chrome-stable -y
```

## â–¶ï¸ Quick Deployment

In the project folder simply run:

```bash
chmod +x build-deploy.sh
./build-deploy.sh
```
---

## â–¶ï¸ Accessing the Application

After deployment completes, the script automatically sets up port-forwarding and displays:

```
âœ… Service available at: http://localhost:8080
â„¹ï¸  Port-forward PID: <process-id> (to stop: kill <process-id>)
```

The application will automatically open in Google Chrome if installed, or you can manually navigate to `http://localhost:8080`

### Stopping the Port-Forward

The port-forward runs in the background. To stop it:
```bash
kill <process-id>  # Use the PID shown in deployment output
```

Or kill all port-forwards:
```bash
pkill -f "port-forward.*earthquake-app"
```

---

## ğŸ” ArgoCD Access

The deployment uses **ArgoCD** for GitOps-based continuous deployment. ArgoCD automatically monitors the Git repository and keeps your cluster in sync with the desired state.

### Accessing ArgoCD UI

After deployment, the script displays ArgoCD credentials:

```
ğŸ” ArgoCD Credentials:
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
Username: admin
Password: <auto-generated-password>
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
```

**To access the ArgoCD UI:**

1. Start port-forward to ArgoCD server:
   ```bash
   kubectl port-forward svc/argocd-server -n argocd 8081:443
   ```

2. Open your browser and navigate to:
   ```
   https://localhost:8081
   ```

3. Login with the credentials displayed during deployment

### What ArgoCD Does

- **GitOps Deployment**: Automatically deploys changes pushed to the `main` branch
- **Auto-Sync**: Keeps cluster state synchronized with Git repository
- **Self-Healing**: Automatically corrects manual changes to match Git state
- **Rollback**: Easy rollback through Git history

The ArgoCD Application manifest is located at `argocd/argocd.yaml` and monitors the `quackwatch-helm/` directory.

### Sync Waves - Deployment Ordering

The deployment uses **ArgoCD Sync Waves** to ensure resources are created in the correct order:

**Wave 0 - Infrastructure** (deployed first):
- Secret (earthquake-secret)
- PersistentVolumeClaim (logs storage)

**Wave 1 - Configuration**:
- ConfigMap (application config)
- ServiceAccount (permissions)

**Wave 2 - Application** (deployed last):
- Deployment (earthquake app pods)
- Service (networking)
- HorizontalPodAutoscaler (auto-scaling)
- CronJob (date logger)

This ensures that:
1. Secrets and storage are available before the app needs them
2. Configuration is loaded before pods start
3. The app only starts when all dependencies are ready

You can view sync waves in ArgoCD UI by checking the "Sync Wave" annotation on each resource.

---

### Link to image on docker hub
https://hub.docker.com/r/blaqr/earthquake

### Helm Chart Repository
```
oci://ghcr.io/gabrielrosinski/quackwatch-helm
```


